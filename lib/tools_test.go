package lib

import (
	"encoding/hex"
	"fmt"
	"github.com/polynetwork/poly/common"
	"github.com/polynetwork/poly/core/payload"
	"github.com/polynetwork/poly/core/types"
	common2 "github.com/polynetwork/poly/native/service/header_sync/common"
	"github.com/polynetwork/poly/native/states"
	"testing"
)

func TestCreateSyncSwthGenesisHdrToPolyTx(t *testing.T) {
	tx := &types.Transaction{}
	raw, err := hex.DecodeString("00d1f762b0a2000000000000000000000000000000000000000000000000fd98040000000000000000000000000000000000000000021173796e6347656e65736973486561646572fd6e040500000000000000fd63040ab4020a02080a1213737769746368656f2d74726164656875622d31189233220c0890cbd9f90510d2bee1a9022a480a20c1148d2a7e5ac8a2e46c7cd2bdf13aa2fb8f9d72eba8f5682273317913e4640d1224080112200f8fd9bb5b0671a544e379a037926e637f3a2666ad0e544d8298c86daabcece232201ab1010b8f48e182896376816a924a4fa7d1c20dd5a7ddc46552795622406a444220c613d2047f36f4936844fe50118d26d08179fcc7df15ee5952490b9ed345d5404a20c613d2047f36f4936844fe50118d26d08179fcc7df15ee5952490b9ed345d5405220048091bc7ddc283f77bfbf91d73c44da58c3df8a9cbc867405d8b7f3daada22f5a20447ac6aeaf29ba85bd2e848ebf888038b4d8419f37478f88870fe2420fa804e172145786dcb5c64bf75f5532a88abf1ef92a0fb3a32c12f5030892331a480a20d5d06a227409c8472fa9978fa2a93bfe1dab4e0fa0b2c1dbcb2353395a1d4e0212240801122053232af2726a36df348ceadafdca4f94055a93b96bfe53762ad3216e53f52fdf2268080212145786dcb5c64bf75f5532a88abf1ef92a0fb3a32c1a0c0892cbd9f90510bd9787cc022240b80b919d5bcb443920fd8e506746a7cf91e8a50e3aaf84f63a15b0b5bd1b5f4f016196bf2dd1569e2835da75fcc5ff3168595f72e1bbe653a51418a7742cab0e2268080212146770992694ea8b3156aa5e235a4424f62c86d5af1a0c0892cbd9f90510bfa4f9e101224079e5e7323976f001a59405fde85517739dffcab6bbbe98fc793ddba19c7cf1dfbb60573e3d9e9409864428e5e43ae3f7282391691fcc7d717d999b20878106002268080212146ff08f4da7c696c9e29799a5d12768c86b378e8a1a0c0892cbd9f90510d380efe101224013f298956c7c2a880f6ac95ff763103ed906ebf61b2019f79c1b40501bc6041abb6d7b36ef17ecd58b9d58b6e94603d5a7d99964c071e4d0262e5f244b00930a22680802121498b71abaa3a73941e89783c48681e0ba1eee00771a0c0892cbd9f9051098edfbcb0222409914e556aa0da99b68b35a7ed5610f3170738b2a58b768a94df34c8c7bb3b2a0fabc3dcfc7bb5c97fcdebe8759b723280b1ce3c64aeed157d873a14218cc510b1a4d0a145786dcb5c64bf75f5532a88abf1ef92a0fb3a32c12251624de6420c9b89ab4927d4c5fcbd4d76dc77fcfd143b89313da82745cfc812efa79d87d52188084af5f20b5a5a4c1fdffffffff011a4e0a146770992694ea8b3156aa5e235a4424f62c86d5af12251624de64206fa625c7ac8a3a875e99c5632dd679de914f774abe5fd21d3a9097283e83ddc518c0c5f8ed01209fecb1d3feffffffff011a490a146ff08f4da7c696c9e29799a5d12768c86b378e8a12251624de6420fec38a82c25b90f6fc8431a67b9d71a063026245987b9f861cb79a718142aed918c0c5f8ed0120ebd9bfc0011a480a1498b71abaa3a73941e89783c48681e0ba1eee007712251624de6420910eb39ccbbc5bb5a767dc5cb0fad9689bdf08a2dbfb5d6b628b9a614349f101188084af5f20c194eaaa020000000000000000000000000000000000000000000001030042011bfd05d1af41f993aa8e8bc1e4dad9c41ad238b076e6a768498d11a53ed6cdbd18072b3bbe8f7306c9efeda1387725e5911871d2b4fdc2d36f4c7959ec4e0a6d2542011c86cf2ae7564ac2e3f147d022cb8fe76d82f8ec1afc4679aabc9781ca6c6c37394f1b94de7ccdad2928022e461154d69f31872082f583fbb37f352263b3b23a2242011b3865ca6815935436c35f64c54d8be6f8c4f20ca0328e36fdefd060408983aa4d63eebd4c054fe50e3c33127c211996ba18e676e12db7967a92713faf979daa5804002312050309c6475ce07577ab72a1f96c263e5030cb53a843b00ca1238a093d9dcb183e2f231205032bed55e8c4d9cbc50657ff5909ee51dc394a92aad911c36bace83c4d6354079423120502e68a6e54bdfa0af47bd18465f4352f5151dc729c61a7399909f1cd1c6d816c022312050229e0d1c5b2ae838930ae1ad861ddd3d0745d1c7f142492cabd02b291d2c95c1d0300")
	if err != nil {
		t.Fatal(err)
	}
	if err := tx.Deserialization(common.NewZeroCopySource(raw)); err != nil {
		t.Fatal(err)
	}

	code := tx.Payload.(*payload.InvokeCode)
	param := &states.ContractInvokeParam{}
	if err := param.Deserialization(common.NewZeroCopySource(code.Code)); err != nil {
		t.Fatal(err)
	}
	np := &common2.SyncGenesisHeaderParam{}
	if err := np.Deserialization(common.NewZeroCopySource(param.Args)); err != nil {
		t.Fatal(err)
	}

	fmt.Println(np.ChainID)

}
